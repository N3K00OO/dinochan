{% extends 'base.html' %}
{% block title %}Booked places • RagaSpace{% endblock %}
{% block content %}
<section class="grid gap-8">
  <div class="rounded-[3rem] border border-white/10 bg-white/5 p-8 shadow-2xl shadow-slate-950/50 backdrop-blur-2xl">
    <h1 class="text-4xl font-semibold text-white">Booked places</h1>
    <p class="mt-2 max-w-2xl text-white/70">Review your confirmed reservations and completed events in one place.</p>
  </div>
  <div class="space-y-4" data-booking-list>
    {% for booking in bookings %}
    <article
      class="rounded-[2.5rem] border border-white/10 bg-white/5 p-6 shadow-xl shadow-slate-950/40 backdrop-blur-xl transition duration-300"
      data-booking-card
      data-booking-id="{{ booking.pk }}"
    >
      <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
        <div class="space-y-1">
          <h2 class="text-2xl font-semibold text-white">{{ booking.venue.name }}</h2>
          <p class="text-sm text-white/60">{{ booking.venue.city }} • {{ booking.venue.location }}</p>
          <a href="{% url 'venue-detail' slug=booking.venue.slug %}" class="inline-flex items-center text-sm font-semibold text-primary transition hover:text-primary/80">View venue details →</a>
        </div>
        <span class="self-start rounded-full border border-white/20 bg-white/10 px-4 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-white/70">
          {{ booking.get_status_display }}
        </span>
      </div>
      <dl class="mt-4 grid gap-2 text-sm text-white/70 sm:grid-cols-2">
        <div>
          <dt class="text-xs uppercase tracking-wider text-white/50">Start</dt>
          <dd class="text-white">{{ booking.start_datetime|date:'M d, Y H:i' }}</dd>
        </div>
        <div>
          <dt class="text-xs uppercase tracking-wider text-white/50">End</dt>
          <dd class="text-white">{{ booking.end_datetime|date:'M d, Y H:i' }}</dd>
        </div>
        <div>
          <dt class="text-xs uppercase tracking-wider text-white/50">Booked on</dt>
          <dd class="text-white">{{ booking.created_at|date:'M d, Y H:i' }}</dd>
        </div>
        <div>
          <dt class="text-xs uppercase tracking-wider text-white/50">Total cost</dt>
          <dd class="text-white">Rp {{ booking.total_cost }}</dd>
        </div>
      </dl>
      <div class="mt-4 text-sm text-white/70">
        <h3 class="text-xs uppercase tracking-wider text-white/50">Add-ons</h3>
        {% with addons=booking.addons.all %}
        {% if addons %}
        <ul class="mt-2 grid gap-1 sm:grid-cols-2">
          {% for addon in addons %}
          <li class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-white/80">
            <span class="block font-semibold text-white">{{ addon.name }}</span>
            <span class="text-xs text-white/60">Rp {{ addon.price }}</span>
          </li>
          {% empty %}
          <li class="text-white/60">No add-ons selected.</li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="mt-2 text-white/60">No add-ons selected.</p>
        {% endif %}
        {% endwith %}
      </div>
      {% if booking.notes %}
      <div class="mt-4 rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-white/70">
        <h3 class="text-xs uppercase tracking-wider text-white/50">Notes</h3>
        <p class="mt-1">{{ booking.notes }}</p>
      </div>
      {% endif %}
      <div class="mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="text-sm text-white/70">
          {% if booking.status == 'active' %}
          <span class="rounded-full border border-amber-300/30 bg-amber-400/10 px-3 py-1 text-amber-200">Awaiting payment</span>
          {% elif booking.status == 'confirmed' %}
          <span class="rounded-full border border-sky-300/30 bg-sky-400/10 px-3 py-1 text-sky-200">Payment received</span>
          {% elif booking.status == 'completed' %}
          <span class="rounded-full border border-white/20 bg-white/10 px-3 py-1 text-white/70">Event completed</span>
          {% endif %}
        </div>
        <div class="flex flex-wrap gap-2">
          {% if booking.status == 'active' %}
          <a
            href="{% url 'payment' booking.pk %}"
            class="inline-flex items-center justify-center rounded-2xl bg-primary px-4 py-2 text-sm font-semibold text-white shadow-md shadow-cyan-500/40 transition hover:bg-primary/80"
          >Complete payment</a>
          {% elif booking.status == 'confirmed' %}
          <span class="inline-flex items-center rounded-2xl border border-white/20 bg-white/10 px-4 py-2 text-sm text-white/70">You're all set! We'll remind you before your event.</span>
          {% endif %}
          {% if booking.status != 'completed' %}
          <button
            type="button"
            data-modal-target="cancel-booking-{{ booking.pk }}"
            class="inline-flex items-center justify-center rounded-2xl border border-white/20 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/10"
            data-booking-cancel-trigger
            data-booking-id="{{ booking.pk }}"
          >Cancel booking</button>
          {% endif %}
        </div>
      </div>
    </article>
    {% endfor %}
  </div>
  <p class="text-white/70{% if bookings %} hidden{% endif %}" data-booking-empty>
    Once a booking is approved by an admin, it will appear here for quick access.
  </p>
</section>
{% for booking in bookings %}
{% if booking.status != 'cancelled' and booking.status != 'completed' %}
<div
  id="cancel-booking-{{ booking.pk }}"
  class="fixed inset-0 z-50 hidden"
  data-modal
  role="dialog"
  aria-modal="true"
  aria-labelledby="cancel-booking-{{ booking.pk }}-title"
  tabindex="-1"
>
  <div class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm" data-modal-close></div>
  <div class="relative mx-auto mt-24 w-full max-w-md rounded-[2rem] border border-white/10 bg-slate-900/95 p-6 shadow-2xl shadow-slate-950/60">
    <div class="flex items-center justify-between">
      <h2 id="cancel-booking-{{ booking.pk }}-title" class="text-xl font-semibold text-white">Cancel this booking?</h2>
      <button type="button" class="rounded-full border border-white/20 bg-white/10 px-3 py-1 text-lg text-white transition hover:bg-white/20" data-modal-close aria-label="Close">×</button>
    </div>
    <p class="mt-3 text-sm text-white/70">Cancelling will release the reservation slot and reset any pending payments. You can always book the venue again if it's still available.</p>
    <div class="mt-6 flex flex-col gap-3 sm:flex-row sm:justify-end">
      <button type="button" class="inline-flex items-center justify-center rounded-2xl border border-white/20 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/10" data-modal-close>Keep booking</button>
      <form method="post" action="{% url 'booking-cancel' booking.pk %}" data-cancel-booking-form data-booking-id="{{ booking.pk }}">
        {% csrf_token %}
        <button type="submit" class="inline-flex items-center justify-center rounded-2xl bg-rose-500 px-4 py-2 text-sm font-semibold text-white shadow-md shadow-rose-500/40 transition hover:bg-rose-400">Cancel booking</button>
      </form>
    </div>
  </div>
</div>
{% endif %}
{% endfor %}
{% endblock %}
